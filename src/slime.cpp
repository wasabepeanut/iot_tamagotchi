// Animation state
bool slimeToggle = false;
unsigned long lastSlimeSwitch = 0;
bool slimeNeedsRedraw = true;

#include "slime.h"
#include "monitor.h"

const uint64_t slimeBody2[52] = {
    0b0000000000000000000000000000000000000000000000000000000000000,
    0b0000000000000000000000000000000000000000000000000000000000000,
    0b0000000000000000000000000000000000000000000000000000000000000,
    0b0000000000000000000000000000000000000000000000000000000000000,
    0b0000000000000000000000000111111111100000000000000000000000000,
    0b0000000000000000000000000111111111100000000000000000000000000,
    0b0000000000000000000000000111111111100000000000000000000000000,
    0b0000000000000000000000000111111111100000000000000000000000000,
    0b0000000000000000000000000111111111100000000000000000000000000,
    0b0000000000000000000011111000000000011111000000000000000000000,
    0b0000000000000000000011111000000000011111000000000000000000000,
    0b0000000000000000000011111000000000011111000000000000000000000,
    0b0000000000000000000011111000000000011111000000000000000000000,
    0b0000000000000000000011111000000000011111000000000000000000000,
    0b0000000000000001111100000000000000000000111110000000000000000,
    0b0000000000000001111100000000000000000000111110000000000000000,
    0b0000000000000001111100000000000000000000111110000000000000000,
    0b0000000000000001111100000000000000000000111110000000000000000,
    0b0000000000000001111100000000000000000000111110000000000000000,
    0b0000000000111110000000000000000000000000000001111100000000000,
    0b0000000000111110000000000000000000000000000001111100000000000,
    0b0000000000111110000000000000000000000000000001111100000000000,
    0b0000000000111110000000000000000000000000000001111100000000000,
    0b0000000000111110000000000000000000000000000001111100000000000,
    0b0000011111000000000000000000000000000000000000000011111000000,
    0b0000011111000000000000000000000000000000000000000011111000000,
    0b0000011111000000000000000000000000000000000000000011111000000,
    0b0000011111000000000000000000000000000000000000000011111000000,
    0b0000011111000000000000000000000000000000000000000011111000000,
    0b1111100000000000000000000000000000000000000000000000000011110,
    0b1111100000000000000000000000000000000000000000000000000011110,
    0b1111100000000001111000000000000000000000011110000000000011110,
    0b1111100000000001111000000000000000000000011110000000000011110,
    0b1111100000000001111000000000000000000000011110000000000011110,
    0b1111100000000001111000000000000000000000011110000000000011110,
    0b1111100000000000000011111111111111111111000000000000000011110,
    0b1111100000000000000011111111111111111111000000000000000011110,
    0b1111100000000000000011111111111111111111000000000000000011110,
    0b1111100000000000000011111111111111111111000000000000000011110,
    0b0000011111000000000000000000000000000000000000000011111000000,
    0b0000011111000000000000000000000000000000000000000011111000000,
    0b0000011111000000000000000000000000000000000000000011111000000,
    0b0000011111000000000000000000000000000000000000000011111000000,
    0b0000011111000000000000000000000000000000000000000011111000000,
    0b0000000000111110000000000000000000000000000001111100000000000,
    0b0000000000111110000000000000000000000000000001111100000000000,
    0b0000000000111111111111111111111111111111111111111100000000000,
    0b0000000000111111111111111111111111111111111111111100000000000,
    0b0000000000111111111111111111111111111111111111111100000000000,
    0b0000000000000001111111111111111111111111111110000000000000000,
    0b0000000000000001111111111111111111111111111110000000000000000
};

const uint64_t slimeBody[52] = {
  0b0000000000000000000000000111111111100000000000000000000000000,
  0b0000000000000000000000000111111111100000000000000000000000000,
  0b0000000000000000000000000111111111100000000000000000000000000,
  0b0000000000000000000000000111111111100000000000000000000000000,
  0b0000000000000000000000000111111111100000000000000000000000000,
  0b0000000000000000000011111000000000011111000000000000000000000,
  0b0000000000000000000011111000000000011111000000000000000000000,
  0b0000000000000000000011111000000000011111000000000000000000000,
  0b0000000000000000000011111000000000011111000000000000000000000,
  0b0000000000000000000011111000000000011111000000000000000000000,
  0b0000000000000001111100000000000000000000111110000000000000000,
  0b0000000000000001111100000000000000000000111110000000000000000,
  0b0000000000000001111100000000000000000000111110000000000000000,
  0b0000000000000001111100000000000000000000111110000000000000000,
  0b0000000000000001111100000000000000000000111110000000000000000,
  0b0000000000111110000000000000000000000000000001111100000000000,
  0b0000000000111110000000000000000000000000000001111100000000000,
  0b0000000000111110000000000000000000000000000001111100000000000,
  0b0000000000111110000000000000000000000000000001111100000000000,
  0b0000000000111110000000000000000000000000000001111100000000000,
  0b0000011111000000000000000000000000000000000000000011111000000,
  0b0000011111000000000000000000000000000000000000000011111000000,
  0b0000011111000000000000000000000000000000000000000011111000000,
  0b0000011111000000000000000000000000000000000000000011111000000,
  0b0000011111000000000000000000000000000000000000000011111000000,
  0b1111100000000000000000000000000000000000000000000000000011110,
  0b1111100000000000000000000000000000000000000000000000000011110,
  0b1111100000000001111000000000000000000000011110000000000011110,
  0b1111100000000001111000000000000000000000011110000000000011110,
  0b1111100000000001111000000000000000000000011110000000000011110,
  0b1111100000000001111000000000000000000000011110000000000011110,
  0b1111100000000000000011111111111111111111000000000000000011110,
  0b1111100000000000000011111111111111111111000000000000000011110,
  0b1111100000000000000011111111111111111111000000000000000011110,
  0b1111100000000000000011111111111111111111000000000000000011110,
  0b1111100000000000000000000000000000000000000000000000000011110,
  0b1111100000000000000000000000000000000000000000000000000011110,
  0b1111100000000000000000000000000000000000000000000000000011110,
  0b1111100000000000000000000000000000000000000000000000000011110,
  0b0000011111000000000000000000000000000000000000000011111000000,
  0b0000011111000000000000000000000000000000000000000011111000000,
  0b0000011111000000000000000000000000000000000000000011111000000,
  0b0000011111000000000000000000000000000000000000000011111000000,
  0b0000011111000000000000000000000000000000000000000011111000000,
  0b0000000000111110000000000000000000000000000001111100000000000,
  0b0000000000111110000000000000000000000000000001111100000000000,
  0b0000000000111111111111111111111111111111111111111100000000000,
  0b0000000000111111111111111111111111111111111111111100000000000,
  0b0000000000111111111111111111111111111111111111111100000000000,
  0b0000000000000001111111111111111111111111111110000000000000000,
  0b0000000000000001111111111111111111111111111110000000000000000
};


// --- Helper: Draw scaled pixel block ---
static inline void drawBlock(int x, int y, uint16_t color, int scale = SLIME_SCALE) {
    for (int dy = 0; dy < scale; dy++) {
        for (int dx = 0; dx < scale; dx++) {
            tft.drawPixel(x + dx, y + dy, color);
        }
    }
}

// --- Draw slime pixel art centered ---
void slimeDraw(uint16_t color) {
    static bool lastToggle = false;
    int scaledWidth = SLIME_WIDTH * SLIME_SCALE;
    int scaledHeight = SLIME_HEIGHT * SLIME_SCALE;
    int startX = (SCREEN_WIDTH - scaledWidth) / 2;
    int startY = (SCREEN_HEIGHT - scaledHeight) / 2 + SLIME_OFFSET_Y;

    // Only clear and redraw if frame changed
    if (slimeToggle != lastToggle) {
        tft.fillRect(startX, startY, scaledWidth, scaledHeight, ST77XX_BLACK);
        lastToggle = slimeToggle;
    }

    // Choose which body to draw
    const uint64_t* body = slimeToggle ? slimeBody2 : slimeBody;
    for (int y = 0; y < SLIME_HEIGHT; y++) {
        for (int x = 0; x < SLIME_WIDTH; x++) {
            if (body[y] & (1ULL << (SLIME_WIDTH - 1 - x))) {
                drawBlock(startX + x * SLIME_SCALE, startY + y * SLIME_SCALE, color, SLIME_SCALE);
            }
        }
    }
}

// Call this in your main loop to update animation state
void slimeAnimate() {
    unsigned long now = millis();
    if (now - lastSlimeSwitch > 500) {
        slimeToggle = !slimeToggle;
        lastSlimeSwitch = now;
    }
}